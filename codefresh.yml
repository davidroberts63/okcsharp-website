version: "1.0"
steps:
    get_version:
        image: python:latest
        commands:
            - git config --global user.name "CodeFresh"
            - git config --global user.email "noone@okcsharp.net"
            - sed -i'' "s~https://github.com/techlahoma/okcsharp-website.git~https://${GH_TOKEN}:x-oauth-basic@github.com/davidroberts63/okcsharp-website.git~" _config.yml
            - sed -i'' "s~PUT_KEY_HERE~${MEETUP_TOKEN}~" thecodeputter.yml
            - pip install -r pypackages.txt
            - python put-meetup-event.py
        when:
            condition:
                all:
                    explicitlyRun: "'${{CF_BUILD_TRIGGER}}' == 'webhook'"
    deploy_site:
        image: node:latest
        commands:
            - git config --global user.name "CodeFresh"
            - git config --global user.email "noone@okcsharp.net"
            - sed -i'' "s~https://github.com/techlahoma/okcsharp-website.git~https://${GH_TOKEN}:x-oauth-basic@github.com/davidroberts63/okcsharp-website.git~" _config.yml
            - rm -rf .deploy_git/
            - hexo clean
            - hexo generate
            - hexo deploy
        when:
            branch:
                only:
                    - master
